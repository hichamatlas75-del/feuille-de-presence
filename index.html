<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Feuille de Pr√©sence Mobile - 2026</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 10px; 
            font-size: 16px;
            background: #f5f5f5;
        }
        h1 { font-size: 1.5em; margin: 0 0 15px 0; color: #333; }
        .header { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin-bottom: 20px; 
            align-items: center; 
        }
        .header input, .header button { 
            flex: 1; 
            min-width: 120px; 
            padding: 12px; 
            font-size: 16px; 
            border-radius: 5px;
        }
        .header button { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            flex-shrink: 0; 
        }
        .header button:hover { background: #45a049; }
        .add-form { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .add-form h3 { margin: 0 0 10px 0; font-size: 1.1em; }
        .add-form input { 
            width: 100%; 
            margin: 5px 0; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 16px; 
        }
        .add-form button { 
            width: 100%; 
            padding: 12px; 
            background: #2196F3; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            font-size: 16px; 
            margin-top: 10px;
        }
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        #tablePresence { 
            width: 100%; 
            border-collapse: collapse; 
            min-width: 700px;
        }
        #tablePresence th, #tablePresence td { 
            border: 1px solid #ddd; 
            padding: 10px 6px; 
            text-align: center; 
            font-size: 14px; 
        }
        #tablePresence th { 
            background: #4CAF50; 
            color: white; 
            font-weight: bold;
            position: sticky; top: 0;
        }
        #tablePresence td:first-child, #tablePresence th:first-child { 
            min-width: 140px; 
            text-align: left; 
            position: sticky; left: 0;
            background: #f9f9f9;
            z-index: 2;
        }
        input[type="checkbox"] { 
            width: 22px; 
            height: 22px; 
            transform: scale(1.1); 
            cursor: pointer;
        }
        input[type="time"], input[type="text"] { 
            width: 100%; 
            padding: 6px; 
            border: none; 
            font-size: 14px; 
            background: transparent;
        }
        input[type="text"]:focus, input[type="time"]:focus {
            background: white;
            outline: 2px solid #4CAF50;
        }
        @media (min-width: 768px) {
            body { padding: 20px; }
            .table-container { margin: 0 auto; max-width: 1200px; }
        }
        @media print {
            body { padding: 0; background: white; }
            .add-form, .header button:not(#printBtn) { display: none; }
            .table-container { box-shadow: none; overflow: visible; }
            #tablePresence { min-width: auto; }
        }
    </style>
</head>
<body>
    <h1>üçΩÔ∏è Feuille de Pr√©sence Restaurant</h1>
    
    <div class="header">
        <input type="date" id="date" value="2026-01-18">
        <button onclick="sauvegarderDonnees()">üíæ Sauvegarder</button>
        <button id="printBtn" onclick="imprimer()">üñ®Ô∏è Imprimer</button>
        <button onclick="restaurerListe()">üîÑ Reset</button>
    </div>

    <div class="add-form">
        <h3>‚ûï Ajouter Nouvel Employ√©</h3>
        <input type="text" id="nomAjout" placeholder="Nom (ex: DUPONT)">
        <input type="text" id="prenomAjout" placeholder="Pr√©nom (ex: Jean)">
        <input type="text" id="fonctionAjout" placeholder="Fonction (CAISSE, BAR...)">
        <button onclick="ajouterEmploye()">Ajouter Employ√©</button>
    </div>

    <div class="table-container">
        <table id="tablePresence">
            <thead>
                <tr>
                    <th>Nom Pr√©nom</th>
                    <th>Fonction</th>
                    <th>ON</th>
                    <th>OFF</th>
                    <th>H. Pr√©vue</th>
                    <th>H. Arriv√©e</th>
                    <th>Signature</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // 24 employ√©s complets
        const employesInit = [
            {nom: 'SALIL', prenom: 'HOUDA', fonction: 'CAISSE'},
            {nom: 'BENKHADA', prenom: 'ABDESLAM', fonction: 'CAISSE'},
            {nom: 'ENNHAIlI', prenom: 'SOUMIA', fonction: 'EXONOMAT 07:45'},
            {nom: 'CHKAIRI', prenom: 'YOUSSEF', fonction: 'BAR'},
            {nom: 'KHALOUQ', prenom: 'RACHID', fonction: 'BAR'},
            {nom: 'FILALI', prenom: 'ABDERAFI', fonction: 'BAR'},
            {nom: 'EL KOBBI', prenom: 'MOSTAFA', fonction: 'BAR'},
            {nom: 'SBAI', prenom: 'HAKIMA', fonction: 'MENAGE'},
            {nom: 'ELGORRAMY', prenom: 'SOUAD', fonction: 'MENAGE'},
            {nom: 'ELGORRAMY', prenom: 'ANISSA', fonction: 'MENAGE'},
            {nom: 'ELMCHAOURI', prenom: 'SOUAD', fonction: 'MENAGE'},
            {nom: 'ZAIR', prenom: 'FATIMA', fonction: 'CUISINE'},
            {nom: 'BELQASSE', prenom: 'KHAOULA', fonction: 'CUISINE'},
            {nom: 'MAJDOUB', prenom: 'JIHANE', fonction: 'CUISINE'},
            {nom: 'LEMSSIEH', prenom: 'JAWAD', fonction: 'CUISINE'},
            {nom: 'BOURAHMA', prenom: 'ANAS', fonction: 'CUISINE'},
            {nom: 'MOUJAHID', prenom: 'IMANE', fonction: 'CUISINE'},
            {nom: 'IDRISSI', prenom: 'SAAD', fonction: 'CUISINE'},
            {nom: 'GUETIBI', prenom: 'AMINE', fonction: 'SERVICE'},
            {nom: 'EL MOEDEN', prenom: 'HASSAN', fonction: 'SERVICE'},
            {nom: 'HIDARA', prenom: 'YOUSSEF', fonction: 'SERVICE'},
            {nom: 'ALAOUI', prenom: 'LAZIZ', fonction: 'SERVICE'},
            {nom: 'HATTAF', prenom: 'MOHAMED', fonction: 'SERVICE'},
            {nom: 'MOHSINE', prenom: 'YOUNESS', fonction: 'SERVICE'}
        ];

        let employes = employesInit;
        let donneesPresence = {};

        // ‚úÖ SAUVEGARDE SIMPLIFI√âE ET FONCTIONNELLE
        function sauvegarderDonnees() {
            const date = document.getElementById('date').value;
            if (!date) {
                alert('‚ö†Ô∏è Choisissez une date !');
                return;
            }

            const lignes = document.querySelectorAll('#tablePresence tbody tr');
            const dateData = {};

            // Lire chaque ligne du tableau
            Array.from(lignes).forEach((ligne, index) => {
                if (index >= employes.length) return;
                
                const inputs = ligne.querySelectorAll('input');
                const nom = employes[index].nom;
                const prenom = employes[index].prenom;
                const key = nom + '_' + prenom;

                dateData[key] = {
                    on: inputs[2] ? inputs[2].checked : false,
                    off: inputs[3] ? inputs[3].checked : false,
                    heurePrevue: inputs[4] ? inputs[4].value : '',
                    heureArrivee: inputs[5] ? inputs[5].value : '',
                    signature: inputs[6] ? inputs[6].value : ''
                };
            });

            // ‚úÖ SAUVEGARDE V√âRIFI√âE
            donneesPresence[date] = dateData;
            localStorage.setItem('donneesPresence_' + date.replace(/-/g, ''), JSON.stringify(dateData));
            localStorage.setItem('employesPresence', JSON.stringify(employes));
            
            alert('‚úÖ ' + Object.keys(dateData).length + ' employ√©s SAUVEGARD√âS pour ' + date);
        }

        function afficherTable() {
            const tbody = document.querySelector('#tablePresence tbody');
            const date = document.getElementById('date').value || '2026-01-18';
            
            tbody.innerHTML = '';

            employes.forEach(emp => {
                // Charger donn√©es sauvegard√©es
                const savedData = localStorage.getItem('donneesPresence_' + date.replace(/-/g, ''));
                const donneesJour = savedData ? JSON.parse(savedData)[emp.nom + '_' + emp.prenom] : {};

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${emp.nom} ${emp.prenom}</td>
                    <td>${emp.fonction}</td>
                    <td><input type="checkbox" ${donneesJour?.on ? 'checked' : ''}></td>
                    <td><input type="checkbox" ${donneesJour?.off ? 'checked' : ''}></td>
                    <td><input type="time" step="300" value="${donneesJour?.heurePrevue || ''}"></td>
                    <td><input type="time" step="300" value="${donneesJour?.heureArrivee || ''}"></td>
                    <td><input type="text" placeholder="Sig." value="${donneesJour?.signature || ''}"></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function ajouterEmploye() {
            const nom = document.getElementById('nomAjout').value.toUpperCase().trim();
            const prenom = document.getElementById('prenomAjout').value.toUpperCase().trim();
            const fonction = document.getElementById('fonctionAjout').value.toUpperCase().trim();
            
            if (nom && prenom) {
                employes.push({nom, prenom, fonction});
                document.getElementById('nomAjout').value = '';
                document.getElementById('prenomAjout').value = '';
                document.getElementById('fonctionAjout').value = '';
                localStorage.setItem('employesPresence', JSON.stringify(employes));
                afficherTable();
            }
        }

        function restaurerListe() {
            if (confirm('Restaurer les 24 employ√©s ?')) {
                employes = [...employesInit];
                localStorage.setItem('employesPresence', JSON.stringify(employes));
                afficherTable();
            }
        }

        function imprimer() {
            window.print();
        }

        // D√©marrage automatique
        document.addEventListener('DOMContentLoaded', function() {
            // Charger employ√©s sauvegard√©s ou initiaux
            const saved = localStorage.getItem('employesPresence');
            if (saved) employes = JSON.parse(saved);
            
            document.getElementById('date').addEventListener('change', afficherTable);
            afficherTable();
        });
    </script>
</body>
</html>
